//----------------------------------------------------------------------------------------------------------------------
#include "CManualResetEvent.h"
#include <chrono>
#include <Framework/Platform/Global/Macros.h>
//----------------------------------------------------------------------------------------------------------------------
namespace CPPFoundation
{
//----------------------------------------------------------------------------------------------------------------------
namespace Foundation
{
//----------------------------------------------------------------------------------------------------------------------
	using namespace std;
	using namespace std::chrono;
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
	CManualResetEvent::CManualResetEvent(void)
		: MMutex(), MConditionalVariable(), MIsSignalized(false)
	{
	}
//----------------------------------------------------------------------------------------------------------------------
	CManualResetEvent::CManualResetEvent(bool IsSignalized)
		: MMutex(), MConditionalVariable(), MIsSignalized(IsSignalized)
	{
	}
//----------------------------------------------------------------------------------------------------------------------
	CManualResetEvent::~CManualResetEvent(void)
	{
	}
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------
	bool CManualResetEvent::IsSignalized(void) const
	{
		unique_lock<mutex>										Lock(MMutex);
		{
			return(MIsSignalized);
		}
	}
//----------------------------------------------------------------------------------------------------------------------
	void CManualResetEvent::Set(void)
	{
		unique_lock<mutex>										Lock(MMutex);
		{
			MIsSignalized=true;

			MConditionalVariable.notify_all();
		}
	}
//----------------------------------------------------------------------------------------------------------------------
	void CManualResetEvent::Reset(void)
	{
		unique_lock<mutex>										Lock(MMutex);
		{
			MIsSignalized=false;
		}
	}
//----------------------------------------------------------------------------------------------------------------------
	void CManualResetEvent::Wait(void) const
	{
		unique_lock<mutex>										Lock(MMutex);
		{
			MConditionalVariable.wait(Lock,[this]{return(MIsSignalized);});
		}
	}
//----------------------------------------------------------------------------------------------------------------------
	bool CManualResetEvent::Wait(uint64 Milliseconds) const
	{
		unique_lock<mutex>										Lock(MMutex);
		{
			duration<uint64,milli>								Timeout(Milliseconds);
			bool												IsSignalized=MConditionalVariable.wait_for(Lock,Timeout,[this]{return(MIsSignalized);});

			return(IsSignalized);
		}
	}
//----------------------------------------------------------------------------------------------------------------------
}
//----------------------------------------------------------------------------------------------------------------------
}
//----------------------------------------------------------------------------------------------------------------------